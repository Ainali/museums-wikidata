<!DOCTYPE html>
<html>
<head>
	<title>Museer i Sverige</title>
	<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" type="text/css"/>
	<link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css" type="text/css"/>
	
	  <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
	  <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	  <script type="text/javascript" src="bower_components/accounting.js/accounting.min.js"></script>
	  <script type="text/javascript" src="bower_components/leaflet/dist/leaflet.js"></script>
</head>
<body>
	<table id="museer" class="table table-striped">
		<thead>
		<tr>
			<th>Nummer
</th>
		<th>Wikidata-ID</th>
	<th>Namn</th>
	<th>Latitud</th>
	<th>Longitud</th>
	<th>Bes&ouml;kssiffror</th>
	<th>&Aring;r</th>
</tr>
</thead>
<tbody>
</tbody>
	</table>
	<script>

	//ladda direkt från api (i två steg) istället för från lokala kopior
	//använd ?callback=function

$.getJSON('http://wdq.wmflabs.org/api?q=claim[31:(tree[33506][][279])]%20AND%20tree[34][150][17,131]&callback=?', function (museer) {


		var j = 0;
		var appendIDs = "";
		var defaultApiString = "https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&props=labels|claims&ids=";
		/*
		$(this).each(function() {
		$("table").append("<tr><td>" + museer.items.id + "</td><td>" + museer.items.id + "</td></tr>");
	});
*/



/*
			var museumid = museer.items[i].toString();
			var apiString = "https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&props=labels|claims&ids=Q";
			apiString += museumid;
			apiString += "&callback=museiinfo"
			detaljinfo[i] = $.getJSON(apiString, function (museiinfo) {
		$.each(museiinfo.entities, function(k, v) {
			n++;
			
		if(v.claims.P625) {
			var latitude = v.claims.P625[0].mainsnak.datavalue.value.latitude;
			var longitude = v.claims.P625[0].mainsnak.datavalue.value.longitude;
		}
		else {var latitude = ""; var longitude = ""; }

		if(v.claims.P856) {
			var url = v.claims.P856[0].mainsnak.datavalue.value;
			var name = '<a href="' + url + '">' + v.labels.sv.value + "</a>";
		}
		else {var name = v.labels.sv.value; }

		if(v.claims.P1174) {
			var visitorsPerYear = accounting.formatNumber(Number(v.claims.P1174[0].mainsnak.datavalue.value.amount), 0, " ")
			;
			if(v.claims.P1174[0].qualifiers) {
				if(v.claims.P1174[0].qualifiers.P585) {
					var visitorsDate = v.claims.P1174[0].qualifiers.P585[0].datavalue.value.time;
					var visitorsYear = String(visitorsDate).substr(8, 4);

				}
				else { var visitorsDate = ""; var visitorsYear = ""; }
			}
			else { var visitorsDate = ""; var visitorsYear = ""; }
		}
		else {var visitorsPerYear = ""; var visitorsDate = ""; var visitorsYear = ""; }

		$("tbody").append('<tr><td>'+ n +'</td><td><a href="https://www.wikidata.org/wiki/'+ k + '">' + k + '</a></td><td>'+ name +'</td><td>'+ latitude +'</td><td>'+ longitude +'</td><td>'+ visitorsPerYear +'</td><td>' + visitorsYear +'</td></tr>');
	});
			});
			*/
	});

/*
	var n = 0;
	for (var i = 1; i < 9; i++) {
		$.getJSON('museer' + i + '.json', function (json) {
		
		$.each(json.entities, function(k, v) {
			n++;
			
		if(v.claims.P625) {
			var latitude = v.claims.P625[0].mainsnak.datavalue.value.latitude;
			var longitude = v.claims.P625[0].mainsnak.datavalue.value.longitude;
		}
		else {var latitude = ""; var longitude = ""; }

		if(v.claims.P856) {
			var url = v.claims.P856[0].mainsnak.datavalue.value;
			var name = '<a href="' + url + '">' + v.labels.sv.value + "</a>";
		}
		else {var name = v.labels.sv.value; }

		if(v.claims.P1174) {
			var visitorsPerYear = accounting.formatNumber(Number(v.claims.P1174[0].mainsnak.datavalue.value.amount), 0, " ")
			;
			if(v.claims.P1174[0].qualifiers) {
				if(v.claims.P1174[0].qualifiers.P585) {
					var visitorsDate = v.claims.P1174[0].qualifiers.P585[0].datavalue.value.time;
					var visitorsYear = String(visitorsDate).substr(8, 4);

				}
				else { var visitorsDate = ""; var visitorsYear = ""; }
			}
			else { var visitorsDate = ""; var visitorsYear = ""; }
		}
		else {var visitorsPerYear = ""; var visitorsDate = ""; var visitorsYear = ""; }

		$("tbody").append('<tr><td>'+ n +'</td><td><a href="https://www.wikidata.org/wiki/'+ k + '">' + k + '</a></td><td>'+ name +'</td><td>'+ latitude +'</td><td>'+ longitude +'</td><td>'+ visitorsPerYear +'</td><td>' + visitorsYear +'</td></tr>');
	});
		});	
	};

	*/
	</script>
</body>
</html>